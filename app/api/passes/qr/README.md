# Dynamic QR Code API

## Overview

This API dynamically generates QR codes from the backend for passes. QR codes are cryptographically signed and include expiry timestamps for security.

## Endpoints

### GET `/api/passes/qr?passId=xxx`

Generate a QR code for an existing pass.

**Response**:
```json
{
  "success": true,
  "passId": "abc123",
  "qrCode": "data:image/png;base64,...",
  "passType": "group_events",
  "userId": "user_id",
  "status": "paid"
}
```

### POST `/api/passes/qr`

Generate a test QR code with custom data.

**Request Body**:
```json
{
  "passId": "test_123",
  "userId": "user_456",
  "passType": "test_pass"
}
```

**Response**:
```json
{
  "success": true,
  "passId": "test_123",
  "userId": "user_456",
  "passType": "test_pass",
  "qrCode": "data:image/png;base64,...",
  "qrData": {
    "passId": "test_123",
    "userId": "user_456",
    "passType": "test_pass",
    "token": "test_123:1773153774973.9c65b8bd4de077e8"
  }
}
```

## Usage Examples

### Generate Test QR Code

```bash
curl -X POST http://localhost:3000/api/passes/qr \
  -H "Content-Type: application/json" \
  -d '{"passId":"test_pass_1","userId":"user_123","passType":"test_pass"}'
```

### Retrieve QR for Existing Pass

```bash
curl "http://localhost:3000/api/passes/qr?passId=your_pass_id_here"
```

## QR Code Security

- **Signed Tokens**: Each QR includes an HMAC-SHA256 signature
- **Expiry**: Tokens expire after 30 days
- **Validation**: Scanner verifies signature and expiry before accepting

## Integration

1. **After Payment**: QR codes are automatically generated by webhook/verify routes
2. **Display**: Use the `qrCode` field (data URL) in `<img>` tags or native image components
3. **Regenerate**: Call GET endpoint anytime to regenerate QR for existing pass
